<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘å€‘çš„é›²ç«¯è¨˜å¸³æœ¬</title>
    <!-- å¼•å…¥ç©©å®šçš„ CDN è³‡æº -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #f8fafc;
        }
        
        /* åº•éƒ¨å°è¦½åˆ—åç™½æ•ˆæœ */
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border-radius: 99px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #94a3b8; /* æœªé¸ä¸­é¡è‰² */
        }
        .nav-item.active {
            background-color: #0f172a;
            color: #ffffff;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }
        .nav-text {
            font-size: 12px;
            font-weight: 900;
            margin-left: 8px;
            display: none; /* é è¨­ä¸é¡¯ç¤ºæ–‡å­— */
        }
        .nav-item.active .nav-text {
            display: inline; /* é¸ä¸­å¾Œæ‰é¡¯ç¤ºæ–‡å­— */
        }

        /* æœˆæ›†ç¶²æ ¼ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .day-btn {
            aspect-ratio: 1;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
            transition: all 0.2s;
        }
        .day-btn.selected {
            background-color: #0f172a;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* å‹•ç•« */
        .fade-up {
            animation: slideUp 0.4s ease-out forwards;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="pb-28">
    <div id="root"></div>

    <!-- React æ¸²æŸ“é‚è¼¯ -->
    <script type="module">
        import React, { useState, useEffect, useMemo } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';

        function App() {
            // ç‹€æ…‹ç®¡ç†
            const [activeTab, setActiveTab] = useState('book'); // book, stats, settings
            const [transactions, setTransactions] = useState(() => JSON.parse(localStorage.getItem('our_ledger_data') || '[]'));
            const [selectedDate, setSelectedDate] = useState(new Date());
            const [currentMonth, setCurrentMonth] = useState(new Date());
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [tempAmount, setTempAmount] = useState('');
            const [tempNote, setTempNote] = useState('');
            const [tempCategory, setTempCategory] = useState('ğŸ²');

            const categories = [
                { icon: 'ğŸ²', name: 'é¤é£²', color: 'bg-orange-400' },
                { icon: 'ğŸš—', name: 'äº¤é€š', color: 'bg-blue-400' },
                { icon: 'ğŸ ', name: 'å±…å®¶', color: 'bg-emerald-400' },
                { icon: 'ğŸ®', name: 'å¨›æ¨‚', color: 'bg-purple-400' },
                { icon: 'ğŸ›ï¸', name: 'è³¼ç‰©', color: 'bg-rose-400' }
            ];

            // å„²å­˜è³‡æ–™
            useEffect(() => {
                localStorage.setItem('our_ledger_data', JSON.stringify(transactions));
            }, [transactions]);

            // æœˆæ›†è¨ˆç®—
            const calendarDays = useMemo(() => {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const arr = [];
                for (let i = 0; i < firstDay; i++) arr.push(null);
                for (let i = 1; i <= daysInMonth; i++) arr.push(new Date(year, month, i));
                return arr;
            }, [currentMonth]);

            const dateKey = (d) => d ? `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}` : '';
            const selectedDateKey = dateKey(selectedDate);

            // çµ±è¨ˆæ•¸æ“š
            const stats = useMemo(() => {
                const filtered = transactions.filter(t => t.date.startsWith(`${currentMonth.getFullYear()}-${currentMonth.getMonth()+1}`));
                const total = filtered.reduce((sum, t) => sum + t.amount, 0);
                return { total, list: filtered };
            }, [transactions, currentMonth]);

            const handleSave = () => {
                if (!tempAmount) return;
                const newTx = {
                    id: Date.now(),
                    amount: parseFloat(tempAmount),
                    note: tempNote || "æœªåˆ†é¡é …ç›®",
                    icon: tempCategory,
                    date: selectedDateKey
                };
                setTransactions([newTx, ...transactions]);
                setIsModalOpen(false);
                setTempAmount('');
                setTempNote('');
            };

            return React.createElement('div', { className: "max-w-md mx-auto min-h-screen" },
                // Header
                React.createElement('header', { className: "bg-white p-6 pt-12 rounded-b-[2.5rem] shadow-sm flex justify-between items-center sticky top-0 z-40" },
                    React.createElement('div', null,
                        React.createElement('h1', { className: "text-xl font-black text-slate-800" }, "æˆ‘å€‘çš„è¨˜å¸³æœ¬"),
                        React.createElement('p', { className: "text-[10px] text-emerald-500 font-bold" }, "â— é›¢ç·šå„²å­˜åŠŸèƒ½å·²å•Ÿç”¨")
                    )
                ),

                // Main Content
                React.createElement('main', { className: "p-4 fade-up" },
                    activeTab === 'book' && React.createElement('div', null,
                        // æœˆæ›†å¡ç‰‡
                        React.createElement('div', { className: "bg-white p-5 rounded-[2rem] shadow-sm mb-6" },
                            React.createElement('div', { className: "flex justify-between items-center mb-6" },
                                React.createElement('button', { onClick: () => setCurrentMonth(new Date(currentMonth.setMonth(currentMonth.getMonth()-1))) }, "â†"),
                                React.createElement('span', { className: "font-black" }, `${currentMonth.getFullYear()}å¹´ ${currentMonth.getMonth()+1}æœˆ`),
                                React.createElement('button', { onClick: () => setCurrentMonth(new Date(currentMonth.setMonth(currentMonth.getMonth()+1))) }, "â†’")
                            ),
                            React.createElement('div', { className: "calendar-grid mb-2" }, ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'].map(d => React.createElement('div', { key: d, className: "text-center text-[10px] font-black text-slate-300" }, d))),
                            React.createElement('div', { className: "calendar-grid" },
                                calendarDays.map((d, i) => {
                                    if (!d) return React.createElement('div', { key: i });
                                    const active = dateKey(d) === selectedDateKey;
                                    const hasData = transactions.some(t => t.date === dateKey(d));
                                    return React.createElement('button', {
                                        key: i,
                                        onClick: () => setSelectedDate(d),
                                        className: `day-btn ${active ? 'selected' : 'hover:bg-slate-50'}`
                                    }, d.getDate(), hasData && !active && React.createElement('div', { className: "absolute w-1 h-1 bg-rose-400 rounded-full mt-6" }));
                                })
                            )
                        ),
                        // æ”¯å‡ºæ˜ç´°
                        React.createElement('div', { className: "space-y-3" },
                            transactions.filter(t => t.date === selectedDateKey).length === 0 ? 
                                React.createElement('div', { className: "text-center py-10 text-slate-300 font-bold" }, "ä»Šå¤©é‚„æ²’æœ‰ç´€éŒ„å–”") :
                                transactions.filter(t => t.date === selectedDateKey).map(t => React.createElement('div', { key: t.id, className: "bg-white p-4 rounded-3xl flex justify-between items-center shadow-sm" },
                                    React.createElement('div', { className: "flex items-center gap-4" },
                                        React.createElement('div', { className: "text-2xl" }, t.icon),
                                        React.createElement('div', null,
                                            React.createElement('p', { className: "font-black text-sm text-slate-800" }, t.note),
                                            React.createElement('button', { onClick: () => setTransactions(transactions.filter(item => item.id !== t.id)), className: "text-[10px] text-rose-400 font-bold" }, "åˆªé™¤")
                                        )
                                    ),
                                    React.createElement('p', { className: "font-black text-lg" }, `$${t.amount.toLocaleString()}`)
                                ))
                        )
                    ),

                    activeTab === 'stats' && React.createElement('div', { className: "bg-white p-8 rounded-[2rem] shadow-sm text-center" },
                        React.createElement('p', { className: "text-xs font-bold text-slate-400 mb-2" }, "æœ¬æœˆç´¯è¨ˆæ”¯å‡º"),
                        React.createElement('p', { className: "text-4xl font-black text-slate-900 mb-8" }, `$${stats.total.toLocaleString()}`),
                        React.createElement('div', { className: "space-y-4" },
                            categories.map(cat => {
                                const amount = stats.list.filter(t => t.icon === cat.icon).reduce((s,t)=>s+t.amount,0);
                                if (amount === 0) return null;
                                return React.createElement('div', { key: cat.icon },
                                    React.createElement('div', { className: "flex justify-between text-xs font-bold mb-1" },
                                        React.createElement('span', null, `${cat.icon} ${cat.name}`),
                                        React.createElement('span', null, `$${amount.toLocaleString()}`)
                                    ),
                                    React.createElement('div', { className: "h-2 bg-slate-100 rounded-full overflow-hidden" },
                                        React.createElement('div', { className: `${cat.color} h-full`, style: { width: `${(amount/stats.total)*100}%` } })
                                    )
                                );
                            })
                        )
                    ),

                    activeTab === 'settings' && React.createElement('div', { className: "bg-white p-8 rounded-[2rem] shadow-sm" },
                        React.createElement('h3', { className: "font-black mb-4" }, "å¸³æœ¬è¨­å®š"),
                        React.createElement('p', { className: "text-sm text-slate-500 mb-6" }, "ç›®å‰è³‡æ–™å­˜å„²æ–¼æœ¬æ©Ÿç€è¦½å™¨ä¸­ã€‚"),
                        React.createElement('button', { onClick: () => { if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿ")) setTransactions([]); }, className: "w-full py-4 bg-rose-50 text-rose-500 rounded-2xl font-black text-sm" }, "æ¸…ç©ºæ‰€æœ‰è³‡æ–™")
                    )
                ),

                // Floating Action Button
                activeTab === 'book' && React.createElement('button', {
                    onClick: () => setIsModalOpen(true),
                    className: "fixed bottom-24 right-6 w-14 h-14 bg-rose-500 text-white rounded-2xl shadow-xl flex items-center justify-center active:scale-90 transition-transform z-40"
                }, "ï¼‹"),

                // Bottom Nav
                React.createElement('nav', { className: "fixed bottom-6 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-md p-2 rounded-full flex gap-1 shadow-2xl z-50 border border-slate-100" },
                    [
                        { id: 'book', icon: 'book', text: 'è¨˜å¸³' },
                        { id: 'stats', icon: 'pie-chart', text: 'åˆ†æ' },
                        { id: 'settings', icon: 'settings', text: 'è¨­å®š' }
                    ].map(tab => React.createElement('button', {
                        key: tab.id,
                        onClick: () => setActiveTab(tab.id),
                        className: `nav-item ${activeTab === tab.id ? 'active' : ''}`
                    }, 
                        React.createElement('i', { 'data-lucide': tab.icon, size: 20 }),
                        React.createElement('span', { className: "nav-text" }, tab.text)
                    ))
                ),

                // Add Modal
                isModalOpen && React.createElement('div', { className: "fixed inset-0 z-[100] flex items-end justify-center p-4" },
                    React.createElement('div', { className: "absolute inset-0 bg-slate-900/60 backdrop-blur-sm", onClick: () => setIsModalOpen(false) }),
                    React.createElement('div', { className: "relative bg-white w-full max-w-sm rounded-[3rem] p-8 shadow-2xl animate-up" },
                        React.createElement('h3', { className: "font-black text-center mb-6" }, "æ–°å¢æ”¯å‡º"),
                        React.createElement('input', { 
                            type: "number", 
                            value: tempAmount, 
                            onChange: e => setTempAmount(e.target.value),
                            placeholder: "0", 
                            className: "w-full text-5xl font-black text-center mb-8 outline-none" 
                        }),
                        React.createElement('div', { className: "grid grid-cols-5 gap-3 mb-8" },
                            categories.map(c => React.createElement('button', {
                                key: c.icon,
                                onClick: () => setTempCategory(c.icon),
                                className: `aspect-square rounded-2xl flex items-center justify-center text-xl ${tempCategory === c.icon ? 'bg-slate-900 text-white scale-110 shadow-lg' : 'bg-slate-50'}`
                            }, c.icon))
                        ),
                        React.createElement('input', { 
                            type: "text", 
                            value: tempNote,
                            onChange: e => setTempNote(e.target.value),
                            placeholder: "å‚™è¨»å…§å®¹...", 
                            className: "w-full p-4 bg-slate-50 rounded-2xl font-bold mb-6 outline-none" 
                        }),
                        React.createElement('button', { onClick: handleSave, className: "w-full py-5 bg-slate-900 text-white rounded-3xl font-black shadow-lg" }, "å„²å­˜ç´€éŒ„")
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
        
        // åœ–æ¨™åˆå§‹åŒ–
        setInterval(() => lucide.createIcons(), 500);
    </script>
</body>
</html>

